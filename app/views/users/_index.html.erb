<% friends = current_user.friends %>
<% pending_request_friends = current_user.pending_request_friends %>
<% pending_friends = current_user.pending_friends %>
<% users.reject! { |user| friends.include?(user) || pending_request_friends.include?(user) || user == current_user } %>

<div class="user-list">
  <% unless users.empty? %>
    <h1>Users</h1>
    <% users.each do |user| %>
      <div class="user group">
        <br>
        <%= image_tag user.profile.profile_img.url(:small) %>
        <%= user.name.html_safe %>
        <br>
        <% if pending_friends.include?(user) %>
          <% friendship = Friendship.find_pair(current_user, user) %>
          <%= button_to "Pending: Cancel Request", deny_friendship_url(friendship), method: "delete", class: "friend-button", "data-remote" => "true" %>
        <% else %>
          <%= button_to "Friend Request", user_friendship_url(user), method: "post", class: "friend-button", "data-remote" => "true" %>
        <% end %>
        <form class="friend-button" action="<%= new_message_url %>" data-remote="true" method="get">
          <input type="hidden" name="recipient_id" value="<%= user.id %>">
          <input type="submit" value="Send Message">
        </form>
      <% end %>
    </div>
  <% end %>
</div>